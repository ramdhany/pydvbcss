

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>CSS-WC Protocol Introduction &mdash; pydvbcss 0.2-latest documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="pydvbcss 0.2-latest documentation" href="index.html"/>
        <link rel="up" title="CSS-WC protocol" href="wc.html"/>
        <link rel="next" title="CSS-WC Message objects" href="wc-messages.html"/>
        <link rel="prev" title="CSS-WC protocol" href="wc.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> pydvbcss</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="examples.html">Run the examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="examples.html#wallclockserver-py-and-wallclockclient-py"><strong>WallClockServer.py</strong> and <strong>WallClockClient.py</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#ciiserver-py-and-ciiclient-py"><strong>CIIServer.py</strong> and <strong>CIIClient.py</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#tsserver-py-and-tsclient-py"><strong>TSServer.py</strong> and <strong>TSClient.py</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#tvdevice-py"><strong>TVDevice.py</strong></a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="protocol.html">DVB CSS Protocol modules</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="cii.html">CSS-CII protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="ts.html">CSS-TS protocol</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="wc.html">CSS-WC protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="protocol.html#common-types-and-objects">Common types and objects</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="timing.html">Clocks, Time and Scheduling modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="monotonic_time.html">Montonic time functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="clock.html">Synthesised clocks (dvbcss.clock)</a></li>
<li class="toctree-l2"><a class="reference internal" href="Task.html">Task scheduling for clocks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="internals.html">Internal implementation details</a><ul>
<li class="toctree-l2"><a class="reference internal" href="servers-internals.html">Protocol server implementation details</a></li>
<li class="toctree-l2"><a class="reference internal" href="task-internals.html">How the dvbcss.task module works internally</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">pydvbcss</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
          <li><a href="protocol.html">DVB CSS Protocol modules</a> &raquo;</li>
      
          <li><a href="wc.html">CSS-WC protocol</a> &raquo;</li>
      
    <li>CSS-WC Protocol Introduction</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/wc-overview.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="css-wc-protocol-introduction">
<h1>CSS-WC Protocol Introduction<a class="headerlink" href="#css-wc-protocol-introduction" title="Permalink to this headline">¶</a></h1>
<p><strong>Here is a quick introduction to the CSS-WC protocol. For full details, refer to the</strong>
<a class="reference external" href="https://www.dvb.org/search/results/keywords/A167">DVB specification</a>.</p>
<p>The CSS-WC protocol is for establishing <em>Wall clock synchronisation</em> - meaning
that there is a common synchronised sense of time (a &#8220;wall clock&#8221;) between the
server (e.g. TV) and client (e.g. companion). This common wall clock is used
in the CSS-TS protocol to make it immune to network delays.</p>
<p>The client uses the information carried in the protocol to estimate the server
wall clock and attempt to compensate for network latency.  This is a
connectionless UDP protocol similar to NTP&#8217;s client-server mode of
operation, but much simplified and not intended to set the system real-time
clock.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#sequence-of-interaction" id="id2">Sequence of interaction</a></li>
<li><a class="reference internal" href="#synchronising-the-wall-clock" id="id3">Synchronising the wall clock</a></li>
<li><a class="reference internal" href="#message-format" id="id4">Message format</a></li>
</ul>
</div>
<div class="section" id="sequence-of-interaction">
<h2><a class="toc-backref" href="#id2">Sequence of interaction</a><a class="headerlink" href="#sequence-of-interaction" title="Permalink to this headline">¶</a></h2>
<p>The client is assumed to already know the host and port number of the CSS-WC
server (usually from the information received via the
<a class="reference internal" href="cii.html"><em>CSS-CII protocol</em></a>).</p>
<ol class="arabic simple">
<li>The client sends a Wall Clock protocol &#8220;request&#8221; message to the server.</li>
<li>The server sends back a Wall Clock protocol &#8220;response&#8221; message to the client.</li>
</ol>
<p>3. If the server is able to more accurately measure when it sent a message
<em>after</em> it has done so, then it can optionally send a &#8220;follow-up response&#8221; with
this information.</p>
<p>The client repeats this process as often as it needs to.</p>
</div>
<div class="section" id="synchronising-the-wall-clock">
<h2><a class="toc-backref" href="#id3">Synchronising the wall clock</a><a class="headerlink" href="#synchronising-the-wall-clock" title="Permalink to this headline">¶</a></h2>
<p>The client notes the time at which the request is sent and the response received,
and by the server including the times at which it received the request and
sent its response. Using this information the client can estimate the difference
between the time of its clock and that of the server. It can also calculate
an error bound on this (known as dispersion):</p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/wc-request-response.png"><img alt="_images/wc-request-response.png" class="align-center" src="_images/wc-request-response.png" style="width: 128pt;" /></a>
</div></blockquote>
<p>Estimated offset = (( <em>t3</em> + <em>t2</em> ) - ( <em>t4</em> + <em>t1</em> )) / 2</p>
<p>The <a class="reference external" href="https://www.dvb.org/search/results/keywords/A167">DVB specification</a>
contains an annex that goes into more detail on the
theory of how to calculate dispersion and how a client can use this
as part of a simple algorithm to align its wall clock.</p>
</div>
<div class="section" id="message-format">
<h2><a class="toc-backref" href="#id4">Message format</a><a class="headerlink" href="#message-format" title="Permalink to this headline">¶</a></h2>
<p>Requests and responses both have the same fixed 32 byte binary message format.
A <a class="reference internal" href="wc-messages.html#dvbcss.protocol.wc.WCMessage" title="dvbcss.protocol.wc.WCMessage"><tt class="xref py py-class docutils literal"><span class="pre">WCMessage</span></tt></a> carries the following fields:</p>
<ul class="simple">
<li>Protocol <strong>version</strong> identifier</li>
<li>Message <strong>type</strong> (request / response / response-before-follow-up / follow-up)</li>
<li>The <strong>precision</strong> of the server&#8217;s wall clock</li>
<li>The <strong>maximum frequency error</strong> of the server&#8217;s wall clock</li>
<li>Timevalues (in NTP 64-bit time format, comprising a 32bit word carrying the
number of nanoseconds and another 32bit word containing the number of seconds)<ul>
<li><strong>Originate timevalue:</strong> when the client sent the request.</li>
<li><strong>Receive timevalue:</strong> when the server received the request.</li>
<li><strong>Transmit timevalue:</strong> when the server sent the response.</li>
</ul>
</li>
</ul>
<p>The <em>precision</em>, <em>max freq error</em>, <em>receive timevalue</em> and <em>transmit timevalue</em> fields only
have meaning in a response from a server. Their values do not matter in requests.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="wc-messages.html" class="btn btn-neutral float-right" title="CSS-WC Message objects"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="wc.html" class="btn btn-neutral" title="CSS-WC protocol"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, British Broadcasting Corporation.
      Last updated on Mar 17, 2015.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.2-latest',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>